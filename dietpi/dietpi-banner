#!/bin/bash
{
	#////////////////////////////////////
	# DietPi Banner Script
	#
	#////////////////////////////////////
	# Created by Dan Knight / daniel_haze@hotmail.com / fuzon.co.uk
	#
	#////////////////////////////////////
	#
	# Info:
	# - filename /boot/dietpi/dietpi-banner
	# - Checks /tmp/dietpi/.update_available 
	#////////////////////////////////////

	#dietpi-banner 0 = top section only
	#dietpi-banner 1 = top section and credits

	INPUT=0
	if [[ $1 =~ ^-?[0-9]+$ ]]; then
		INPUT=$1
	fi

	#/////////////////////////////////////////////////////////////////////////////////////
	#Obtain Hardware Description
	#/////////////////////////////////////////////////////////////////////////////////////
	HW_MODEL_DESCRIPTION=$(sed -n 2p /tmp/dietpi/.hw_model)

	Hardware_Model_Print(){
		echo -e " V$DIETPI_VERSION \e[90m|\e[0m $HW_MODEL_DESCRIPTION \n \e[38;5;93m───────────────────────────────────────\e[0m"
	}
	
	#/////////////////////////////////////////////////////////////////////////////////////
	#Get current version
	#/////////////////////////////////////////////////////////////////////////////////////
	DIETPI_VERSION=$(cat /tmp/dietpi/.version)

	#/////////////////////////////////////////////////////////////////////////////////////
	#Update available / MOTD 
	#/////////////////////////////////////////////////////////////////////////////////////
	RND=0
	TEXT_TEMP=""

	UPDATE_TEXT=""
	UPDATE_AVAILABLE=0
	if [ -f /tmp/dietpi/.update_available ]; then
		UPDATE_AVAILABLE=$(cat /tmp/dietpi/.update_available)

		if (( $UPDATE_AVAILABLE > 0 )); then
			UPDATE_TEXT="\e[90m|\e[0m \e[91mUpdate available\e[0m"
		elif (( $UPDATE_AVAILABLE == -1 )); then
			UPDATE_TEXT="\e[90m|\e[0m \e[91mImage available\e[0m"
		fi

	#Use UPDATE_TEXT for storing helpful info
	else
		#rnd starts from index 0
		RND=$(( (RANDOM % 8) ))
		TEXT_TEMP=""
		if (( $RND == 0 )); then
			TEXT_TEMP="Lightweight justice!"
		elif (( $RND == 1 )); then
			TEXT_TEMP="o0o0o0o so smooth."
		elif (( $RND == 2 )); then
			TEXT_TEMP="Optimized awesomeness."
		elif (( $RND == 3 )); then
			TEXT_TEMP="Freaky fast!"
		elif (( $RND == 4 )); then
			TEXT_TEMP="Fuzon.co.uk"
		elif (( $RND == 5 )); then
			TEXT_TEMP=$(date +"%d-%m-%Y")
		elif (( $RND == 6 )); then
			TEXT_TEMP="Not powered by hampster."
		elif (( $RND == 7 )); then
			TEXT_TEMP="Without tea and crumpets!"
		fi

		UPDATE_TEXT="\e[90m| $TEXT_TEMP\e[0m"
	fi

	#/////////////////////////////////////////////////////////////////////////////////////
	# Banner Print
	#/////////////////////////////////////////////////////////////////////////////////////
	Banner_Dietpi(){
		clear
		echo -e " \e[38;5;93m───────────────────────────────────────\e[0m\n \e[1mD I E T - P I\e[0m $UPDATE_TEXT \n \e[38;5;93m───────────────────────────────────────\e[0m"
		Hardware_Model_Print
	}

	Credits_Print(){
		echo -e "\n\e[90m Created by: Dan Knight\e[0m"
		echo -e "\e[90m fuzon.co.uk | daniel_haze@hotmail.com\e[0m\n"
		echo -e " Commands:"
		echo -e "\e[1m dietpi-config\e[0m    = Feature rich system configuration tool."
		echo -e "\e[1m dietpi-software\e[0m  = Select / Install optimized software."
		echo -e "\e[1m dietpi-uninstall\e[0m = Remove DietPi Installed Software."
		#Update available
		if (( $UPDATE_AVAILABLE > 0 )); then
			echo -e "\e[1m dietpi-update\e[0m    = \e[91mRun now to update DietPi (from V$DIETPI_VERSION to V$UPDATE_AVAILABLE).\e[0m"
		elif (( $UPDATE_AVAILABLE == -1 )); then
			echo -e "\n\e[91m An updated DietPi image is available, please goto:\e[0m\n http://fuzon.co.uk/phpbb/viewtopic.php?f=8&t=9#p9\n"
		else
			echo -e "\e[1m dietpi-update\e[0m    = Update DietPi to the latest version."
		fi
		echo -e "\e[1m htop\e[0m             = Resource monitor."
		echo -e ""
	}

	#/////////////////////////////////////////////////////////////////////////////////////
	# Main Loop
	#/////////////////////////////////////////////////////////////////////////////////////
	if (( $INPUT == 0 )); then
		Banner_Dietpi
	elif (( $INPUT == 1 )); then
		Banner_Dietpi
		Credits_Print
	fi

	#Run whole script in a function. Loads into memory, allows for online file patching.
	exit
}