#!/bin/bash
# Let's Encrypt cert status
# must be root to dig this => to be run with sudo
certinfo='No certificate found'
for i in /etc/letsencrypt/live/*/cert.pem
        do
                [[ -f $i ]] || continue
                certinfo=$(sudo openssl x509 -enddate -noout -in "$i" | mawk '/notAfter=/{print "Valid until "$4"-"substr($1,10)"-"$2" "$3}' 2>&1)
                break
        done
echo $certinfo
